<a-scene fog="type: exponential; color: black; density: 0.025">

  <a-assets>
    <a-asset id="invader-obj" src="assets/invader-2.obj"></a-asset>
    <img id="floor-texture" src="assets/floor.gif">
    <img id="sky-texture" src="assets/stars.gif">
  </a-assets>

  <a-sky material="shader: gif; src: #sky-texture; repeat: 10 5; fog: false"></a-sky>

  <a-entity id="#rig" [attr.position]="{x: me.x, y: 0, z: me.z}|aframe">
    <a-camera position="0 1.6 0" look-controls wasd-controls
      rotation-listener (rotationChanged)="onRotationChanged($event)"
      position-listener (positionChanged)="onPositionChanged($event)">
    </a-camera>
  </a-entity>

  <a-box position="0 5 0" radius="0.5" [attr.fireball]="{ color: (color$ | async) } | aframe"></a-box>

  <a-plane material="shader:gif; src:#floor-texture; repeat: 100 100"
     rotation="-90 0 0" width="300" height="300"></a-plane>

  <a-entity *ngFor="let user of users; trackBy: userId" 
    [attr.position]="{x: user.x, y: 1.5+(user.jump?user.jump/15:0), z: user.z}|aframe">
    <a-entity [attr.visible]="!user.me" obj-model="obj: #invader-obj" [attr.material]="{color:user.color}|aframe"
      [attr.rotation]="{x: user.rotationX, y: user.rotationY, z: 0}|aframe"></a-entity>
  </a-entity>

  <a-sphere position="0 5 0" *ngFor="let ball of balls" 
    animation__scale="property: scale; from: 0.5 0.5 0.5; to: 10 10 10; dur: 4000"
    animation__opacity="property: fireball.opacity; from: 1; to: 0; dur: 4000"
    [attr.fireball]="{ color: (color$ | async) } | aframe"
    [attr.sound]="{ src: sounds.throw.src, autoplay: true } | aframe"
    (animationcomplete)="removeBall(ball)">
  </a-sphere>
</a-scene>